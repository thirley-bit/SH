{"version":3,"sources":["index.js","dist/index.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;ACFA,ADGA;ACFA,ADGA;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["module.exports = require('./dist/index.js').default\n\nmodule.exports.default = module.exports\nmodule.exports.Weapp = require('./dist/index.js').Weapp\n","\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar service = require('@tarojs/service');\nvar template = require('@tarojs/shared/dist/template');\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\n\nconst _true = 'true';\nconst _false = 'false';\nconst _empty = '';\nconst _zero = '0';\nconst components = {\n    // ======== 调整属性 ========\n    Progress: {\n        'border-radius': _zero,\n        'font-size': '16',\n        duration: '30',\n        bindActiveEnd: _empty\n    },\n    RichText: {\n        space: _empty,\n        'user-select': _false\n    },\n    Text: {\n        'user-select': _false\n    },\n    Map: {\n        polygons: '[]',\n        subkey: _empty,\n        rotate: _zero,\n        skew: _zero,\n        'max-scale': '20',\n        'min-scale': '3',\n        'enable-3D': _false,\n        'show-compass': _false,\n        'show-scale': _false,\n        'enable-overlooking': _false,\n        'enable-zoom': _true,\n        'enable-scroll': _true,\n        'enable-rotate': _false,\n        'enable-satellite': _false,\n        'enable-traffic': _false,\n        'enable-poi': _true,\n        'enable-building': _true,\n        setting: '[]',\n        bindLabelTap: _empty,\n        bindRegionChange: _empty,\n        bindPoiTap: _empty,\n        bindAnchorPointTap: _empty\n    },\n    Button: {\n        lang: 'en',\n        'session-from': _empty,\n        'send-message-title': _empty,\n        'send-message-path': _empty,\n        'send-message-img': _empty,\n        'app-parameter': _empty,\n        'show-message-card': _false,\n        'business-id': _empty,\n        bindGetUserInfo: _empty,\n        bindContact: _empty,\n        bindGetPhoneNumber: _empty,\n        bindChooseAvatar: _empty,\n        bindError: _empty,\n        bindOpenSetting: _empty,\n        bindLaunchApp: _empty\n    },\n    Form: {\n        'report-submit-timeout': _zero\n    },\n    Input: {\n        'always-embed': _false,\n        'adjust-position': _true,\n        'hold-keyboard': _false,\n        'safe-password-cert-path': '',\n        'safe-password-length': '',\n        'safe-password-time-stamp': '',\n        'safe-password-nonce': '',\n        'safe-password-salt': '',\n        'safe-password-custom-hash': '',\n        'auto-fill': _empty,\n        bindKeyboardHeightChange: _empty,\n        bindNicknameReview: _empty\n    },\n    Picker: {\n        'header-text': _empty\n    },\n    PickerView: {\n        'immediate-change': _false,\n        bindPickStart: _empty,\n        bindPickEnd: _empty\n    },\n    Slider: {\n        color: \"'#e9e9e9'\",\n        'selected-color': \"'#1aad19'\"\n    },\n    Textarea: {\n        'show-confirm-bar': _true,\n        'adjust-position': _true,\n        'hold-keyboard': _false,\n        'disable-default-padding': _false,\n        'confirm-type': \"'return'\",\n        'confirm-hold': _false,\n        bindKeyboardHeightChange: _empty\n    },\n    ScrollView: {\n        'enable-flex': _false,\n        'scroll-anchoring': _false,\n        'refresher-enabled': _false,\n        'refresher-threshold': '45',\n        'refresher-default-style': \"'black'\",\n        'refresher-background': \"'#FFF'\",\n        'refresher-triggered': _false,\n        enhanced: _false,\n        bounces: _true,\n        'show-scrollbar': _true,\n        'paging-enabled': _false,\n        'fast-deceleration': _false,\n        bindDragStart: _empty,\n        bindDragging: _empty,\n        bindDragEnd: _empty,\n        bindRefresherPulling: _empty,\n        bindRefresherRefresh: _empty,\n        bindRefresherRestore: _empty,\n        bindRefresherAbort: _empty\n    },\n    Swiper: {\n        'snap-to-edge': _false,\n        'easing-function': \"'default'\"\n    },\n    SwiperItem: {\n        'skip-hidden-item-layout': _false\n    },\n    Navigator: {\n        target: \"'self'\",\n        'app-id': _empty,\n        path: _empty,\n        'extra-data': _empty,\n        version: \"'version'\"\n    },\n    Camera: {\n        mode: \"'normal'\",\n        resolution: \"'medium'\",\n        'frame-size': \"'medium'\",\n        bindInitDone: _empty,\n        bindScanCode: _empty\n    },\n    Image: {\n        webp: _false,\n        'show-menu-by-longpress': _false\n    },\n    LivePlayer: {\n        mode: \"'live'\",\n        'sound-mode': \"'speaker'\",\n        'auto-pause-if-navigate': _true,\n        'auto-pause-if-open-native': _true,\n        'picture-in-picture-mode': '[]',\n        bindstatechange: _empty,\n        bindfullscreenchange: _empty,\n        bindnetstatus: _empty,\n        bindAudioVolumeNotify: _empty,\n        bindEnterPictureInPicture: _empty,\n        bindLeavePictureInPicture: _empty\n    },\n    Video: {\n        title: _empty,\n        'play-btn-position': \"'bottom'\",\n        'enable-play-gesture': _false,\n        'auto-pause-if-navigate': _true,\n        'auto-pause-if-open-native': _true,\n        'vslide-gesture': _false,\n        'vslide-gesture-in-fullscreen': _true,\n        'ad-unit-id': _empty,\n        'poster-for-crawler': _empty,\n        'show-casting-button': _false,\n        'picture-in-picture-mode': '[]',\n        // picture-in-picture-show-progress 属性先注释掉的原因如下：\n        // 该属性超过了 wxml 属性的长度限制，实际无法使用且导致编译报错。可等微信官方修复后再放开。\n        // 参考1：https://developers.weixin.qq.com/community/develop/doc/000a429beb87f0eac07acc0fc5b400\n        // 参考2: https://developers.weixin.qq.com/community/develop/doc/0006883619c48054286a4308258c00?_at=vyxqpllafi\n        // 'picture-in-picture-show-progress': 'false',\n        'enable-auto-rotation': _false,\n        'show-screen-lock-button': _false,\n        'show-snapshot-button': _false,\n        'show-background-playback-button': _false,\n        'background-poster': _empty,\n        bindProgress: _empty,\n        bindLoadedMetadata: _empty,\n        bindControlsToggle: _empty,\n        bindEnterPictureInPicture: _empty,\n        bindLeavePictureInPicture: _empty,\n        bindSeekComplete: _empty,\n        bindAdLoad: _empty,\n        bindAdError: _empty,\n        bindAdClose: _empty,\n        bindAdPlay: _empty\n    },\n    Canvas: {\n        type: _empty\n    },\n    Ad: {\n        'ad-type': \"'banner'\",\n        'ad-theme': \"'white'\"\n    },\n    CoverView: {\n        'marker-id': _empty,\n        slot: _empty\n    },\n    // ======== 额外组件 ========\n    Editor: {\n        'read-only': _false,\n        placeholder: _empty,\n        'show-img-size': _false,\n        'show-img-toolbar': _false,\n        'show-img-resize': _false,\n        focus: _false,\n        bindReady: _empty,\n        bindFocus: _empty,\n        bindBlur: _empty,\n        bindInput: _empty,\n        bindStatusChange: _empty,\n        name: _empty\n    },\n    MatchMedia: {\n        'min-width': _empty,\n        'max-width': _empty,\n        width: _empty,\n        'min-height': _empty,\n        'max-height': _empty,\n        height: _empty,\n        orientation: _empty\n    },\n    FunctionalPageNavigator: {\n        version: \"'release'\",\n        name: _empty,\n        args: _empty,\n        bindSuccess: _empty,\n        bindFail: _empty,\n        bindCancel: _empty\n    },\n    LivePusher: {\n        url: _empty,\n        mode: \"'RTC'\",\n        autopush: _false,\n        muted: _false,\n        'enable-camera': _true,\n        'auto-focus': _true,\n        orientation: \"'vertical'\",\n        beauty: _zero,\n        whiteness: _zero,\n        aspect: \"'9:16'\",\n        'min-bitrate': '200',\n        'max-bitrate': '1000',\n        'audio-quality': \"'high'\",\n        'waiting-image': _empty,\n        'waiting-image-hash': _empty,\n        zoom: _false,\n        'device-position': \"'front'\",\n        'background-mute': _false,\n        mirror: _false,\n        'remote-mirror': _false,\n        'local-mirror': _false,\n        'audio-reverb-type': _zero,\n        'enable-mic': _true,\n        'enable-agc': _false,\n        'enable-ans': _false,\n        'audio-volume-type': \"'voicecall'\",\n        'video-width': '360',\n        'video-height': '640',\n        'beauty-style': \"'smooth'\",\n        filter: \"'standard'\",\n        animation: _empty,\n        bindStateChange: _empty,\n        bindNetStatus: _empty,\n        bindBgmStart: _empty,\n        bindBgmProgress: _empty,\n        bindBgmComplete: _empty,\n        bindAudioVolumeNotify: _empty\n    },\n    OfficialAccount: {\n        bindLoad: _empty,\n        bindError: _empty\n    },\n    OpenData: {\n        type: _empty,\n        'open-gid': _empty,\n        lang: \"'en'\",\n        'default-text': _empty,\n        'default-avatar': _empty,\n        bindError: _empty\n    },\n    NavigationBar: {\n        title: _empty,\n        loading: _false,\n        'front-color': _empty,\n        'background-color': _empty,\n        'color-animation-duration': _zero,\n        'color-animation-timing-func': \"'linear'\"\n    },\n    PageMeta: {\n        'background-text-style': _empty,\n        'background-color': _empty,\n        'background-color-top': _empty,\n        'background-color-bottom': _empty,\n        'scroll-top': \"''\",\n        'scroll-duration': '300',\n        'page-style': \"''\",\n        'root-font-size': \"''\",\n        bindResize: _empty,\n        bindScroll: _empty,\n        bindScrollDone: _empty\n    },\n    VoipRoom: {\n        openid: _empty,\n        mode: \"'camera'\",\n        'device-position': \"'front'\",\n        bindError: _empty\n    },\n    AdCustom: {\n        'unit-id': _empty,\n        'ad-intervals': _empty,\n        bindLoad: _empty,\n        bindError: _empty\n    },\n    PageContainer: {\n        show: _false,\n        duration: '300',\n        'z-index': '100',\n        overlay: _true,\n        position: \"'bottom'\",\n        round: _false,\n        'close-on-slide-down': _false,\n        'overlay-style': _empty,\n        'custom-style': _empty,\n        bindBeforeEnter: _empty,\n        bindEnter: _empty,\n        bindAfterEnter: _empty,\n        bindBeforeLeave: _empty,\n        bindLeave: _empty,\n        bindAfterLeave: _empty,\n        bindClickOverlay: _empty\n    },\n    ShareElement: {\n        mapkey: _empty,\n        transform: _false,\n        duration: '300',\n        'easing-function': \"'ease-out'\"\n    },\n    KeyboardAccessory: {},\n    RootPortal: {},\n    ChannelLive: {\n        feedId: _empty,\n        finderUserName: _empty\n    },\n    ChannelVideo: {\n        feedId: _empty,\n        finderUserName: _empty,\n        autoPlay: _false,\n        loop: _false,\n        muted: _false,\n        objectFit: \"'contain'\",\n        bindError: _empty\n    },\n};\n\nclass Template extends template.UnRecursiveTemplate {\n    constructor(pluginOptions) {\n        super();\n        this.supportXS = true;\n        this.Adapter = {\n            if: 'wx:if',\n            else: 'wx:else',\n            elseif: 'wx:elif',\n            for: 'wx:for',\n            forItem: 'wx:for-item',\n            forIndex: 'wx:for-index',\n            key: 'wx:key',\n            xs: 'wxs',\n            type: 'weapp'\n        };\n        this.modifyTemplateResult = (res, nodeName, _level, children) => {\n            if (nodeName === 'keyboard-accessory')\n                return '';\n            if ((nodeName === 'textarea' || nodeName === 'input') && this.pluginOptions.enablekeyboardAccessory) {\n                const list = res.split('</template>');\n                const componentAlias = this.componentsAlias[nodeName];\n                const nodeNameAlias = componentAlias._num;\n                const target = `\n    <keyboard-accessory style=\"{{i.cn[0].st}}\" class=\"{{i.cn[0].cl}}\" bindtap=\"eh\"  id=\"{{i.cn[0].uid||i.cn[0].sid}}\" data-sid=\"{{i.cn[0].sid}}\">\n      <block wx:for=\"{{i.cn[0].cn}}\" wx:key=\"sid\">\n        <template is=\"{{xs.e(cid+1)}}\" data=\"{{i:item,l:l}}\" />\n      </block>\n    </keyboard-accessory>\n  `;\n                const templateFocus = list[1]\n                    .replace(children, target)\n                    .replace(`_${nodeNameAlias}_focus`, `_${nodeNameAlias}_focus_ka`);\n                const templateBlur = list[2]\n                    .replace(children, target)\n                    .replace(`_${nodeNameAlias}_blur`, `_${nodeNameAlias}_blur_ka`);\n                list.splice(3, 0, templateFocus, templateBlur);\n                return list.join('</template>');\n            }\n            return res;\n        };\n        this.pluginOptions = pluginOptions || {};\n    }\n    buildXsTemplate() {\n        return '<wxs module=\"xs\" src=\"./utils.wxs\" />';\n    }\n    replacePropName(name, value, componentName, componentAlias) {\n        if (value === 'eh') {\n            const nameLowerCase = name.toLowerCase();\n            if (nameLowerCase === 'bindlongtap' && componentName !== 'canvas')\n                return 'bindlongpress';\n            return nameLowerCase;\n        }\n        if (componentName === 'share-element') {\n            const mapKeyAlias = componentAlias.mapkey;\n            if (value === `i.${mapKeyAlias}`)\n                return 'key';\n        }\n        return name;\n    }\n    buildXSTepFocus(nn) {\n        if (this.pluginOptions.enablekeyboardAccessory) {\n            const textarea = this.componentsAlias.textarea._num;\n            const input = this.componentsAlias.input._num;\n            const ka = this.componentsAlias['keyboard-accessory']._num;\n            return `function(i, prefix) {\n      var s = i.focus !== undefined ? 'focus' : 'blur'\n      var r = prefix + i.${nn} + '_' + s\n      if ((i.nn === '${textarea}' || i.nn === '${input}') && i.cn[0] && i.cn[0].nn === '${ka}') {\n        r = r + '_ka'\n      }\n      return r\n    }`;\n        }\n        else {\n            return super.buildXSTepFocus(nn);\n        }\n    }\n}\n\nconst PACKAGE_NAME = '@tarojs/plugin-platform-weapp';\nclass Weapp extends service.TaroPlatformBase {\n    /**\n     * 1. setupTransaction - init\n     * 2. setup\n     * 3. setupTransaction - close\n     * 4. buildTransaction - init\n     * 5. build\n     * 6. buildTransaction - close\n     */\n    constructor(ctx, config, pluginOptions) {\n        super(ctx, config);\n        this.platform = 'weapp';\n        this.globalObject = 'wx';\n        this.projectConfigJson = this.config.projectConfigName || 'project.config.json';\n        this.runtimePath = `${PACKAGE_NAME}/dist/runtime`;\n        this.taroComponentsPath = `${PACKAGE_NAME}/dist/components-react`;\n        this.fileType = {\n            templ: '.wxml',\n            style: '.wxss',\n            config: '.json',\n            script: '.js',\n            xs: '.wxs'\n        };\n        this.template = new Template(pluginOptions);\n        this.setupTransaction.addWrapper({\n            close() {\n                this.modifyTemplate(pluginOptions);\n                this.modifyWebpackConfig();\n            }\n        });\n    }\n    /**\n     * 增加组件或修改组件属性\n     */\n    modifyTemplate(pluginOptions) {\n        const template = this.template;\n        template.mergeComponents(this.ctx, components);\n        template.voidElements.add('voip-room');\n        template.focusComponents.add('editor');\n        if (pluginOptions === null || pluginOptions === void 0 ? void 0 : pluginOptions.enablekeyboardAccessory) {\n            template.voidElements.delete('input');\n            template.voidElements.delete('textarea');\n        }\n    }\n    /**\n     * 修改 Webpack 配置\n     */\n    modifyWebpackConfig() {\n        this.ctx.modifyWebpackChain(({ chain }) => {\n            // 解决微信小程序 sourcemap 映射失败的问题，#9412\n            chain.output.devtoolModuleFilenameTemplate((info) => {\n                const resourcePath = info.resourcePath.replace(/[/\\\\]/g, '_');\n                return `webpack://${info.namespace}/${resourcePath}`;\n            });\n        });\n    }\n}\n\nvar index = (ctx, options) => {\n    ctx.registerPlatform({\n        name: 'weapp',\n        useConfigName: 'mini',\n        fn({ config }) {\n            return __awaiter(this, void 0, void 0, function* () {\n                const program = new Weapp(ctx, config, options || {});\n                yield program.start();\n            });\n        }\n    });\n};\n\nexports.Weapp = Weapp;\nexports[\"default\"] = index;\n//# sourceMappingURL=index.js.map\n"]}